<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HouseRentValencia ¬∑ Sandra IA</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%2319C37D'/><text x='50' y='58' font-size='54' text-anchor='middle' fill='white' font-family='Arial, Helvetica, sans-serif'>HV</text></svg>">
  <style>
    *{box-sizing:border-box}html{scroll-behavior:smooth}
    :root{ --brand:#19C37D; --ink:#0b0f14; --muted:#667085; --bg:#ffffff; --card:#f5f7f8; --ring:rgba(25,195,125,.25); }
    body{margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; color:var(--ink); background:var(--bg)}
    .container{width:min(1100px,92vw); margin-inline:auto}
    .site-header{position:sticky; top:0; z-index:50; background:rgba(255,255,255,.8); backdrop-filter:saturate(180%) blur(10px); border-bottom:1px solid #eef1f2}
    .header-inner{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none; color:var(--ink); font-weight:700}
    .brand-mark{display:grid; place-items:center; width:36px; height:36px; background:var(--brand); color:#fff; border-radius:10px; font-weight:700}
    .brand-name{letter-spacing:.2px}
    .nav a{color:var(--ink); text-decoration:none; margin-left:18px; font-weight:600}
    .nav a:hover{color:var(--brand)}
    .hero{padding:88px 0 64px; background:linear-gradient(180deg, #f7fbf9, #fff)}
    .hero-inner{display:grid; gap:16px; text-align:center}
    .hero h1{font-size:clamp(28px,5vw,48px); margin:0}
    .hero .soft{font-weight:700; color:var(--brand)}
    .hero p{color:var(--muted); margin:2px 0 8px}
    .cta{display:flex; gap:12px; justify-content:center; margin-top:6px}
    .btn{display:inline-block; padding:12px 18px; border-radius:12px; text-decoration:none; font-weight:700; border:1px solid #e7ecef; cursor:pointer}
    .btn.primary{background:var(--brand); color:#fff; border-color:var(--brand)}
    .btn.ghost{background:#fff; color:var(--ink)}
    .btn.small{padding:8px 12px; border-radius:10px; font-weight:700}
    .btn:focus{outline:3px solid var(--ring)}
    .hero-badges{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:10px}
    .hero-badges span{background:#eef7f2; padding:8px 12px; border-radius:999px; font-weight:600; color:#0f5132}
    .benefits{padding:44px 0}
    .grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:18px}
    .card{background:var(--card); border:1px solid #e9eef0; border-radius:18px; padding:18px}
    .icon{width:40px;height:40px}
    .icon svg{width:100%;height:100%;fill:var(--brand)}
    .card h3{margin:10px 0 6px}
    .card p{margin:0; color:var(--muted)}
    .listings{padding:36px 0 56px; background:linear-gradient(180deg,#fff,#f8fafb)}
    .section-head{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .section-head h2{margin:0}
    .section-head .link{color:var(--brand); text-decoration:none; font-weight:700}
    .home-card{background:#fff; border:1px solid #e9eef0; border-radius:18px; overflow:hidden}
    .photo{height:180px; background:#dbece4 url('https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format&fit=crop&w=1400&q=60') center/cover no-repeat}
    .photo-2{background-image:url('https://images.unsplash.com/photo-1494526585095-c41746248156?auto=format&fit=crop&w=1400&q=60')}
    .photo-3{background-image:url('https://images.unsplash.com/photo-1484154218962-a197022b5858?auto=format&fit=crop&w=1400&q=60')}
    .home-info{padding:14px 16px}
    .price{display:flex; align-items:baseline; gap:8px; color:var(--muted)}
    .price strong{font-size:20px; color:var(--ink)}
    .contact{padding:56px 0}
    .contact-inner{display:grid; grid-template-columns:1.2fr .8fr; gap:22px; align-items:start}
    .contact-form{display:grid; gap:10px}
    .contact-form input, .contact-form textarea{width:100%; padding:12px 14px; border-radius:12px; border:1px solid #e1e6ea; font:inherit}
    .contact-form input:focus, .contact-form textarea:focus{outline:3px solid var(--ring); border-color:var(--brand)}
    .site-footer{border-top:1px solid #eef1f2; padding:18px 0; background:#fff}
    .footer-inner{display:flex; align-items:center; justify-content:space-between}
    @media (max-width: 900px){
      .grid-3{grid-template-columns:1fr}
      .contact-inner{grid-template-columns:1fr}
      .hero{padding:72px 0 40px}
    }
    /* Panel flotante: columna, alto autom√°tico, scroll si hace falta */
    #realtime-container{
      position: fixed;
      bottom: 20px; right: 20px;
      z-index: 9999;
      display: none; /* se muestra al pulsar el FAB */
      width: 380px;
      max-height: calc(100vh - 40px);
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,.2);
      overflow: hidden;
    }
    #realtime-container .panel-body{
      display: flex; flex-direction: column;
      max-height: calc(100vh - 40px - 56px); /* header ~56px */
      overflow-y: auto;
    }

    #open-chat-btn{
      position: fixed;
      bottom: 20px; right: 20px;
      width: 60px; height: 60px; border-radius: 50%;
      display: grid; place-items: center;
      background: var(--brand); color:#fff; border:0; cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.3); z-index: 10000;
    }

    /* Evita solapamientos del "avatar" con el panel */
    #avatar{ display:none; } /* lo mostramos cuando el embed cargue ok */
    #log{height:220px;overflow:auto;background:#f1f5f9;border-radius:10px;padding:10px;font-family:ui-monospace,monospace}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#e2e8f0;margin-right:6px}
    .ok{background:#d1fae5}.bad{background:#fee2e2}
    #vu{height:8px;background:#e2e8f0;border-radius:999px;overflow:hidden}
    #vu > div{height:100%;width:0;background:#fb923c}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a href="#" class="brand">
        <span class="brand-mark" aria-hidden="true">HV</span>
        <span class="brand-name">HouseRentValencia</span>
      </a>
      <nav class="nav">
        <a href="#alojamientos">Alojamientos</a>
        <a href="#ventajas">Ventajas</a>
        <a href="#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container hero-inner">
        <h1>Valencia te espera. <span class="soft">Nosotros te alojamos.</span></h1>
        <p>Dise√±o minimalista, carga veloz y reservas en 3 pasos. Estilo Bizum: simple, directo y encantador.</p>
        <div class="cta">
          <a href="#alojamientos" class="btn primary">Ver alojamientos</a>
          <a id="waHero" class="btn ghost" target="_blank" rel="noopener">WhatsApp</a>
        </div>
        <div class="hero-badges">
          <span>Pago seguro</span>
          <span>Atenci√≥n inmediata</span>
          <span>Check-in flexible</span>
        </div>
      </div>
    </section>

    <section id="ventajas" class="benefits">
      <div class="container grid-3">
        <div class="card">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 2l3 7h7l-5.5 4.2L18 21l-6-4-6 4 1.5-7.8L2 9h7z"/></svg>
          </div>
          <h3>Reserva f√°cil</h3>
          <p>Proceso de reserva en 3 pasos con confirmaci√≥n instant√°nea.</p>
        </div>
        <div class="card">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 1a11 11 0 1011 11A11.013 11.013 0 0012 1zm1 16h-2v-2h2zm0-4h-2V7h2z"/></svg>
          </div>
          <h3>Transparente</h3>
          <p>Precios claros sin sorpresas. Cancelaci√≥n flexible.</p>
        </div>
        <div class="card">
          <div class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24"><path d="M12 12a5 5 0 10-5-5 5 5 0 005 5zm0 2c-4.33 0-8 2.17-8 5v2h16v-2c0-2.83-3.67-5-8-5z"/></svg>
          </div>
          <h3>Asistencia 24/7</h3>
          <p>Habla con Sandra en segundos por voz o WhatsApp.</p>
        </div>
      </div>
    </section>

    <section id="alojamientos" class="listings">
      <div class="container">
        <div class="section-head">
          <h2>Alojamientos destacados</h2>
          <a class="link" href="#">Ver todos</a>
        </div>
        <div class="grid-3">
          <article class="home-card">
            <div class="photo" role="img" aria-label="Apartamento luminoso en Ruzafa"></div>
            <div class="home-info">
              <h3>Ruzafa ¬∑ Suite luminosa</h3>
              <p>2 hu√©spedes ¬∑ 1 dormitorio ¬∑ 1 ba√±o</p>
              <div class="price"><span>desde</span><strong>‚Ç¨78</strong><span>/noche</span></div>
            </div>
          </article>
          <article class="home-card">
            <div class="photo photo-2" role="img" aria-label="Loft moderno cerca de la Ciudad de las Artes"></div>
            <div class="home-info">
              <h3>Ciudad de las Artes ¬∑ Loft</h3>
              <p>3 hu√©spedes ¬∑ 1 dormitorio ¬∑ 1 ba√±o</p>
              <div class="price"><span>desde</span><strong>‚Ç¨92</strong><span>/noche</span></div>
            </div>
          </article>
          <article class="home-card">
            <div class="photo photo-3" role="img" aria-label="√Åtico con terraza en El Caba√±al"></div>
            <div class="home-info">
              <h3>El Caba√±al ¬∑ √Åtico terraza</h3>
              <p>4 hu√©spedes ¬∑ 2 dormitorios ¬∑ 1 ba√±o</p>
              <div class="price"><span>desde</span><strong>‚Ç¨110</strong><span>/noche</span></div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section id="contacto" class="contact">
      <div class="container contact-inner">
        <h2>Contacto r√°pido</h2>
        <form class="contact-form" onsubmit="event.preventDefault(); alert('Gracias. Te respondemos en breve.');">
          <input type="text" name="nombre" placeholder="Nombre" required>
          <input type="tel" name="telefono" placeholder="Tel√©fono">
          <input type="email" name="email" placeholder="Email" required>
          <textarea name="mensaje" rows="4" placeholder="Cu√©ntanos fechas y n¬∫ de personas"></textarea>
          <button class="btn primary" type="submit">Enviar</button>
        </form>
        <div class="contact-side">
          <p><strong>WhatsApp:</strong> <a id="waSide" target="_blank" rel="noopener"></a></p>
          <p><strong>Email:</strong> hola@houserentvalencia.com</p>
          <p><strong>Ubicaci√≥n:</strong> Valencia, Espa√±a</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <small>¬© <span id="y"></span> HouseRentValencia.com</small>
      <nav class="foot-nav">
        <a href="#">Privacidad</a>
        <a href="#">T√©rminos</a>
      </nav>
    </div>
  </footer>

  <button id="open-chat-btn" aria-label="Abrir chat">üó£Ô∏è</button>

  <div id="avatar" style="position:fixed;right:16px;bottom:16px;width:360px;height:520px;background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.18);overflow:hidden;display:flex;flex-direction:column;z-index:1000">
    <div style="padding:10px 12px;background:#0d9488;color:#fff;font-weight:600;display:flex;justify-content:space-between;align-items:center">
      <span>Sandra IA ¬∑ Avatar</span>
      <button id="minAvatar" style="background:transparent;border:0;color:#fff;cursor:pointer;font-size:18px">‚Äî</button>
    </div>
    <iframe id="emb" src="about:blank" style="width:100%;height:100%;border:0;background:#000"></iframe>
  </div>

<div id="realtime-container">
  <header style="background:#0f766e;color:#fff;padding:14px 16px;font-weight:700;display:flex;justify-content:space-between;align-items:center">
    <div>HouseRentValencia ¬∑ Sandra IA</div>
    <button id="close-chat-btn" style="background:transparent;border:0;color:#fff;cursor:pointer">‚úï</button>
  </header>

  <div class="panel-body">
    <!-- AQU√ç deja tu wrap del chat y abajo el bloque del avatar -->
    <section id="realtime" style="flex:1;min-width:320px;max-width:620px;background:#fff;border-radius:16px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:10px">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="pill ok" id="state">Desconectado</span>
        <span class="pill" id="latency">‚Äî</span>
        <span class="pill" id="mic">üéôÔ∏è Mic apagado</span>
      </div>
      <div id="log"></div>
      <div id="log-realtime" style="height:100px;overflow:auto;background:#f8f9fa;border:1px solid #e9ecef;border-radius:6px;padding:8px;font-family:monospace;font-size:12px;margin-top:8px"></div>
      <div id="vu"><div></div></div>
      <div style="margin-top:6px; display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <button id="btnTalk" class="btn primary">Hablar</button>
        <button id="btnMute" class="btn ghost">Silencio</button>
        <input id="txt" placeholder="o escribe y pulsa Enviar" class="btn ghost" style="flex:1;border:1px solid #e2e8f0" />
        <button id="btnSend" class="btn primary">Enviar</button>
      </div>
    </section>

    <div id="avatar" style="width:100%;height:420px;background:#000">
<iframe
  id="emb"
  src="https://console.heygen.com/embeds/a7a7e63f00a74ff984d4b43f984c438c"
  style="width:100%;height:100%;border:0;display:block;flex:1;background:#000"
  allow="autoplay; microphone; clipboard-read; clipboard-write; fullscreen; display-capture">
</iframe>
    </div>
  </div>
</div>

  <script src="./js/app.js"></script>

  <script>
async function loadAvatar(videoId){
  try{
    const r = await fetch('/.netlify/functions/heygen-embed', {
      method:'POST', headers:{'content-type':'application/json'},
      body: JSON.stringify({ video_id: videoId })
    });
    const j = await r.json();
    const emb = document.getElementById('emb');
    emb.src = j.embedUrl || j.fallback || "about:blank";
    document.getElementById('avatar').style.display = emb.src !== "about:blank" ? "block" : "none";
  }catch(e){
    document.getElementById('avatar').style.display = "none";
  }
}
</script>

<script>
  const $logEl = document.getElementById("log-realtime");
  const logger = (t) => {
    const el=document.createElement("div");
    el.textContent=t;
    $logEl.appendChild(el);
    $logEl.scrollTop=$logEl.scrollHeight;
  };
</script>

<script>
  const $txt  = document.getElementById("txt");
  const $mic  = document.getElementById("mic");
  const $log  = document.getElementById("log-realtime");
  const btnSend = document.getElementById("btnSend");
  const btnTalk = document.getElementById("btnTalk");
  const btnMute = document.getElementById("btnMute");

  function writeLog(t){
    const el = document.createElement("div");
    el.textContent = t;
    $log.appendChild(el);
    $log.scrollTop = $log.scrollHeight;
  }

  let muted=false, mediaStream, mediaRec, chunks=[];

  btnSend.addEventListener("click", () => sendText($txt.value));
  $txt.addEventListener("keydown", (e)=>{
    if (e.key === "Enter") { e.preventDefault(); sendText($txt.value); }
  });
  btnTalk.addEventListener("click", startTalk);
  btnMute.addEventListener("click", ()=> {
    muted = !muted;
    $mic.textContent = muted ? "üéôÔ∏è Mic apagado" : "üéôÔ∏è Mic activo";
  });

  async function startTalk(){
    try{
      if(!mediaStream){
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio:true });
        $mic.textContent = "üéôÔ∏è Mic activo";
        writeLog("Micr√≥fono concedido.");
      }
      mediaRec = new MediaRecorder(mediaStream, { mimeType: "audio/webm;codecs=opus" });
      chunks = [];
      mediaRec.ondataavailable = e => e.data.size && chunks.push(e.data);
      mediaRec.onstop = async () => {
        const blob = new Blob(chunks, { type:"audio/webm" });
        chunks = [];
        await sendAudio(blob);
      };
      mediaRec.start();
      writeLog("üé§ Escuchando‚Ä¶ (pulsa Silencio para parar y enviar)");
    }catch(e){ writeLog("Error micr√≥fono: "+e.message); }
  }

  async function sendText(text){
    if(!text.trim()) return;
    writeLog("T√∫: " + text);
    $txt.value = "";
    const r = await fetch("/.netlify/functions/chat", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ text, plan: "visitor" })
    });
    if(!r.ok){ writeLog("Error servidor: "+r.status); return; }
    const buf = await r.arrayBuffer();
    new Audio(URL.createObjectURL(new Blob([buf], { type:"audio/mpeg" }))).play();
  }

  async function sendAudio(blob){
    const form = new FormData(); form.append("audio", blob, "input.webm");
    const r = await fetch("/.netlify/functions/ask", { method:"POST", body: form });
    if(!r.ok){ writeLog("Error servidor: "+r.status); return; }
    const buf = await r.arrayBuffer();
    if(!muted) new Audio(URL.createObjectURL(new Blob([buf], { type:"audio/mpeg" }))).play();
  }
</script>
</body>
</html>
